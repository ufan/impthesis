\chapter{光电倍增管的性能测试与筛选}
\label{ch:pmt_test}
由于制造工艺的限制，光电倍增管具有很强的个体差异性，即不同管子的性能差异较大。
因此，在光电倍增管大规模应用时，往往要求对每支管子进行详细的测试，以得到它们各自的性能参数信息。
利用这些信息，探测器的研制者可以淘汰性能参数不达标的管子，可以决定管子在探测器整体中的安装位置，可以得到管子的额定工作电压，甚至可以在探测器部署运行后调节其实际工作电压，最终使探测器整体的探测性能达到最佳。

对于PSD所使用的R4443型光电倍增管，Hamamatsu公司对每支出厂的管子进行了基本的性能测试(包括阳极暗电流、长时间稳定性、阴极/阳极的光灵敏度以及阴极/阳极的蓝光灵敏度），并提供了相应的测试结果。
然而，这些测试只在一个工作电压点进行，而且使用的测试条件(连续、强烈的白炽光照射)与R4443在PSD中的实际工作条件(低强度、低频率的脉冲光照射)迥异。
另外，PSD使用双打拿极引出的分压器电路与上述出厂测试使用的标准分压器差别较大，导致R4443的工作状态也不一致。
因此，这些参数信息只能定性地给出各支管子的基本性能，不能作为PSD研制过程的定量参考。

上述因素决定了：需要根据PSD的具体需求，在实验室独立对R4443光电倍增管进行性能参数测试。
为此，我们专门设计并搭建了一套的PMT批量测试平台。
本章对该测试平台进行了介绍，并详细叙述了该平台在R4443光电倍增管的性能测试中的应用以及测试结果。
根据测得的性能参数数据，依据性能最佳的原则，我们进一步对所有管子进行了筛选，选出了可以用于PSD安装的光电倍增管。

\section{PMT批量测试平台}
\label{sec:pmt_test:testbench}
PSD的研制过程中涉及大量的PMT测试工作，包括对570支R4443裸光电倍增管的细致性能测试以及在PSD建造过程中将近200个PMT组件的质量测试(详见第\ref{ch:construction}章)。
为了提高工作效率，减轻测试人员的工作负担，我们设计并建造了能够用于PMT大批量测试的专用测试平台。

\subsection{功能与特点}
\label{sec:pmt_test:testbench_functions}
PMT的批量测试是在大型探测器研制过程中经常碰到的工作。
因此，该测试平台虽然是为了DAMPE-PSD项目专门研制的，但我们在设计中充分考虑了该平台的拓展性和可移植性，使得它能够方便地应用于其它项目的PMT测试工作。
该测试平台的主要特点可以归结为如下几点：
\begin{enumerate}
	\item 测试容量大。大型探测器项目动辄涉及成百上千支PMT的测试，如果能够对多支PMT同时进行测试，就可以显著提高工作效率，加快项目进程。该测试平台最大测试容量达到25支PMT，满足大部分项目的测试需求。
	\item 自动化程度高。PMT的细致测试往往涉及不同的性能指标，一次完整的测试需要花费几个小时的时间。这个过程中，需要对大量的仪器设备进行重复操作，如升降高压、切换光强度、移动PMT位置等等。此时，人工操作不仅效率低，而且是不可靠的。因此，该测试平台的关键组件都是用了程控设备，并开发了相应的控制软件，实现了常用设备操的自动化。这样，在PMT的整个测试过程中，人工干预只存在于PMT的安装与卸载，以及相关软件的配置，提高了测试工作的可靠性。
	\item 功能完备。该测试平台能够满足很多潜在的测试需求，即便有些在PSD的研制过程中并不需要。因此，平台使用了一些特殊的硬件模块以及通用的仪器设备。尤其是，我们将三维移动性作为该平台的一个基本功能，使得平台可以用于PMT光阴极的位置扫描。
	\item 扩展性强。测试平台采用模块化设计，其硬件平台是可扩展的，各硬件模块之间的耦合相对松散。这方便了硬件的更换或升级，并可以实现较为复杂的测试方案。软件框架同样基于模块化设计，并对底层硬件进行了虚拟化，使得顶层的测试功能不因底层硬件的改动而有大的变动，增强了测试程序的可移植性。
\end{enumerate}

图\ref{fig:pmt_test:testbench_schematic}给出了PMT批量测试平台的原理框图。
该平台最多可以同时对25支PMT进行测试。光脉冲由一个蓝光LED产生，它经过积分球和集束光纤组成的光分配系统被分成25份，被分别传输到待测PMT的入射端面。
待测PMT都安置在一个固定平台上，而光源和光分配系统被固定在一个三维移动平台上。两个平台相对摆放，从而实现了对所有待测PMT的光阴极位置扫描。
固定平台上同时安置有两支监控PMT，也接受来自光分配系统的两路入射光脉冲。
在整个测试周期中，两支PMT的位置相对于入射光纤固定不变，因此它们被用于监控LED光源以及整个测试平台性能的稳定性。
这两个支撑平台以及上面的所有测试设备都被放置在一个大小为$176cm\times100cm\times78cm$的铝合金暗箱中(见图\ref{fig:pmt_test:blackbox})，箱子的内壁用黑色图层覆盖以降低内部的杂散光污染。

\begin{figure}[htb]
	\centering
	\includegraphics[width=\textwidth]{chap/pmt_test/fig/testbench_schematic.eps}
	\caption{PMT批量测试平台的原理框图}
	\label{fig:pmt_test:testbench_schematic}
\end{figure}

PMT测试平台的大部分辅助设备被都放置在铝合金暗箱的外围，它们与内部器件的连接线缆穿过箱子上不透光的通孔相互联接。
这些辅助设备可以被分为四个不同功能模块，分别为：运动控制模块，光脉冲驱动模块，数据获取模块（简称DAQ模块）以及高压供给模块。
运动控制模块和光驱动模块是和测试平台紧密联系在一起的，而与此相关的设备基本在所有的测试中都可以重复使用。
相反的，DAQ模块和高压供给模块与需要PMT测试的具体项目紧密联系，一般需要使用该项目定制的仪器设备进行测试。
作为一个通用的解决方案，我们为测试平台配备了一个基于CAMAC机箱的DAQ模块以及一个基于CAEN SY1527LC机箱\cite{sy1527lc}的高压供给模块。
这两个模块可以根据具体情况进行更换，在PSD的PMT性能测试中，我们就将上述CAMAC机箱替换成了PSD专用的地面检测系统（详见\ref{sec:pmt_test:characterization}）。

最后，整个PMT测试平台系统被放置在一个十万级的洁净室中，室内温度被控制在$22\pm2$\si{\celsius}。

\subsection{硬件组成以及相关性能测试}
\label{sec:pmt_test:testbench_hardware}
% 总述硬件结构，之后依次介绍各组件以及相关测试结果。
% 主体平台
PMT测试平台的主体由一个固定平台和一个三维移动平台组成(见图\ref{fig:pmt_test:stages})，暗箱内的所有测试器件都被安置在它们上面。
\begin{figure}[htbp]
	\centering
	\subfloat[][铝合金暗箱]{
		\label{fig:pmt_test:blackbox}
		\includegraphics[width=0.49\textwidth]{chap/pmt_test/fig/black_box.jpg}
	}
	\subfloat[][三维移动平台与固定平台]{
		\label{fig:pmt_test:stages}
		\includegraphics[width=0.49\textwidth]{chap/pmt_test/fig/stages.jpg}
	}
	\caption{PMT批量测试平台的主体结构}
	\label{fig:blindfigure}
\end{figure}
两个平台的台面各覆盖有一块面积为$1560mm\times250mm$的光学平板。
平板材质为\SI{2.5}{cm}厚度的不锈钢，因此可以有效抵抗重物放置带来的形变，保持台面上各器件位置的稳定性。
另外，光学平板上布满成网格排布的、并有M4和M6两种规格的螺纹孔，这不仅方便了台面上器件的安装与拆卸，并且提供了额外的摆放灵活性。
三维移动平台可以带动台面完成X-Y-Z三个方向的移动，每个方向都用一个步进电机驱动，其最大负载重量为\SI{30}{\kilo\gram}。
表\ref{tab:pmt_test:motorized_stage}列出了它的基本运动参数。
可以看到，平台的左右行程和上下行程使其能够对所有直径小于\SI{60}{\milli\meter}的PMT进行全面地光阴极扫描。
额外的第三维运动主要用于控制光纤与待测PMT之间的距离，在测试时尽量拉近光纤与PMT端面的距离，而在拆卸时拉远它们之间的距离，从而保护光纤不受意外损伤。
三个方向的步进电机都由一个运动控制器控制\cite{leetro}，并可以利用PCI总线实现远程控制。
\begin{table}[htb]
	\centering	
	\begin{tabulary}{0.6\linewidth}{LC}
		\toprule[1.5pt]
		\textbf{项目} & \textbf{数值}	\\ 
		\midrule[1pt]
		最小步长		& \SI{1.56}{\micro\meter}	\\
		左右行程		& \SI{60}{\milli\meter}	\\
		上下行程		& \SI{70}{\milli\meter}	\\
		前后行程		& \SI{15}{\milli\meter}	\\
		\bottomrule[1.5pt]
	\end{tabulary}
	\caption{三维移动平台的基本运动参数}
	\label{tab:pmt_test:motorized_stage}	
\end{table}
为了方便操作和固定位置，我们还定制了专用的PMT夹具和光纤夹头，图\ref{fig:pmt_test:fixtures}展示了R4443和光纤固定在测试平台上的状态。
其中，光纤夹头可以实现水平方向上的微调，便于将光纤对准PMT光阴极中心（精度在\SI{0.5}{mm}）。
% 紧固件
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.6\textwidth]{chap/pmt_test/fig/fixtures.jpg}
	\caption{PMT夹具和光纤夹头}
	\label{fig:pmt_test:fixtures}
\end{figure}

% 光源以及驱动
PMT测试系统使用大功率的蓝光LED（\SI{3}{\watt}, \SIrange{465}{485}{\nano\meter}）作为光源。
该LED的发光光谱能够与大部分光阴极材料的光谱响应相吻合，而且曾被成功应用到HIRFL-RIBLL2外靶终端的中子墙光刻度系统中\cite{yuyuhong_led}，其功率大小能够满足大量光通路的驱动要求。
为了使LED产生脉冲光，我们采用通用的脉冲发生器AFG3252\cite{afg3252}产生的方波信号来直接驱动LED发光。
虽然AFG3252不是专用的LED驱动器，但它的驱动效果能够满足我们的基本需求，如图\ref{fig:pmt_test:led_pulse}所示。
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.65\textwidth]{chap/pmt_test/fig/led_pulse.jpg}
	\caption{\SI{30}{\nano\second}脉宽，\SI{5}{\nano\second}上升沿/下降沿的方波脉冲驱动LED发光得到的R4443输出波形}
	\label{fig:pmt_test:led_pulse}
\end{figure}
AFG3252的驱动脉冲参数可以在很大的范围内进行调整，而且精度很高，这是专用的LED驱动器达不到，因此可以满足各种各样的光输出要求，增强了PMT测试平台的通用性。
图\ref{fig:pmt_test:led_response}给出了不同脉宽、不同幅度的方波产生的LED光强变化，可以看到脉冲幅度与LED的输出光强并不成正比，这需要在使用中特别加以注意。
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.7\textwidth]{chap/pmt_test/fig/led_response.eps}
	\caption{LED输出脉冲的光强度与AFG3253脉冲幅度的非线性关系}
	\label{fig:pmt_test:led_response}
\end{figure}
AFG3252的另外一个优点是：它的所有功能都可以在远程进行控制，而且接口丰富，我们可以选择熟悉的方式对其进行控制。
在PMT批量测试系统中，我们通过网口，并使用SCPI（Standard Commands for Programmable Instruments）命令\cite{afg3000_programmer_manual}对AFG3252进行远程操作。

% 积分球
LED发出的光脉冲通过集束光纤被分配到各支PMT，它与集束光纤之间通过一个\SI{5}{\centi\meter}的积分球耦合。LED、积分球和集束光纤一起构成了PMT测试系统的光分配系统，如图\ref{fig:pmt_test:light_distribution}。
其中LED通过导热硅胶固定在一个与积分球入射端口适配的底座上，而集束光纤通过三维位移台直接对准积分球出射端口的中心（参加见图\ref{fig:pmt_test:lightsource_integration}）。
\begin{figure}[htbp]
	\centering
	\subfloat[][1）LED 2）积分球 3）集束光纤]{
		\label{fig:pmt_test:lightsource_components}
		\includegraphics[width=0.49\textwidth]{chap/pmt_test/fig/lightsource_components.jpg}
	}
	\subfloat[][各组件耦合在一起]{
		\label{fig:pmt_test:lightsource_integration}
		\includegraphics[width=0.49\textwidth]{chap/pmt_test/fig/lightsource_integration.jpg}
	}		
	\caption{PMT批量测试平台的光源与光分配系统}
	\label{fig:pmt_test:light_distribution}
\end{figure}
积分球是一个具有高反射性内表面的空心球体，它是一个理想的光积分器件，入射光在其内部经过多次反射后，能够在其出射端口均匀出射。
积分器在此处的应用主要出于两点考虑：1）我们希望各条光通路具有相近的光输出强度；2）方便积分球与集束光纤之间的耦合操作，减弱LED光源的非均匀性对各光路输出强度差异的影响。
我们使用的积分球\cite{integrating_sphere}使用的内壁涂层材料为$BaSO_4$，蓝光反射率达到\SI{98.5}{\percent}，因此即便它的半径较小，仍然能够得到较好的均匀性。
在LED固定到积分球入射端口后，我们对积分球出射端面的光强度进行了“十”字扫描，结果显示其光均匀性可以达到$\pm\SI{0.5}{\percent}$，如图\ref{fig:pmt_test:integrationsphere_uniformity}所示。
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.65\textwidth]{chap/pmt_test/fig/integrationsphere_uniformity.eps}
	\caption{\SI{5}{cm}铝合金积分球输出端口的光均匀性}
	\label{fig:pmt_test:integrationsphere_uniformity}
\end{figure}

% 集束光纤
PMT批量测试系统使用的集束光纤由35根塑料包层的石英光纤\cite{optical_fibre}集结而成（25根用于待测光通道，2根用于监控光通道，剩余8根备份）。每根光纤的长度为\SI{1.5}{\meter}，纤芯直径为\SI{400}{\micro\meter}，包层厚度\SI{75}{\micro\meter}，而数值孔径达到了$0.37$。
较大的芯径和数值孔径使得每条光通路都能从积分球中引出足够的光量，并传输到对应的PMT入射端面。
为了避免机械损伤，光纤的两个端头部位都加装了铝合金套筒进行保护，见图\ref{fig:pmt_test:lightsource_components}。
光源和光分配系统固定完成后，我们对35条光通路的输出光强差异进行了测试。
测试使用了两支R4443，一支管子用于监测LED的光强波动，其数值可以对测试结果进行光强校正；另一支管子用于正式测试，它固定不动而待测光纤使用高精度的光纤位移台调整位置，保证每次测试时待测光纤都能对准测试PMT光阴极的相同位置。
测试中，我们使用了两个不同幅度的LED驱动脉冲设置分别对所有光通路进行了扫描。
两种设置虽然有将近4倍的光强差，但它们得到的光强差异是在$\pm \SI{0.3}{\percent}$的范围内是完全一致的，结果如图\ref{fig:pmt_test:fiber_difference}所示。
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.7\textwidth]{chap/pmt_test/fig/fiber_difference.eps}
	\caption{集束光纤各通道的光传输差异性}
	\label{fig:pmt_test:fiber_difference}
\end{figure}
测试结果显示，所有光通路的输出光强度差异不大，但并不完全一致，其分布的标准差为\SI{10}{\percent}。
考虑到积分球的光输出分均匀性只有\SI{0.5}{\percent}，可以认为各光通路的光输出强度差异主要是光纤自身的传输效率差异导致的。
由于传输效率是光纤的固有特征，其在相当长的一段时间内是比较稳定的，可以认为是个常数。
假设本次测试中，编号为$fiberid$的光纤输出光强度为$L_{fiberid}$，同时在所有光通道中选择一个作为参考通道，其输出光强度为$L_{ref}$。
则编号为$fiberid$的光通道的光输出强度差异系数$\tau_{fiberid}$可以定义为：
\begin{equation}
	\tau_{fiberid} = \frac{L_{fiberid}}{L_{ref}}
	\label{eq:pmt_test:lightoutput_difference}
\end{equation}
根据上面的叙述，$\tau_{fiberid}$可以被认为是一个常数，它主要用于对测试数据进行光强校正，使得不同光通道的测试结果可以直接进行比较（详见第\ref{sec:pmt_test:characterization}节）。

\subsection{模块化设计的测控软件}
\label{sec:pmt_test:software}
% 最好这里做一个归纳性的介绍，具体细节设计放到附录中
PMT批量测试平台的测控软件是系统的重要组成部分，它直接关系到平台的易用性。
由于该测试平台被设计为是一个通用的测试系统，我们需要考虑很多潜在的测试内容，并且底层硬件需要经常更换或更新(见\ref{sec:pmt_test:testbench_functions}的描述)。
因此，PMT批量测试平台的测控软件框架采用模块化的设计思路，并对底层硬件进行了封装和虚拟化，从而方便软件进行维护以及扩展。
测控软件框架基于C++语言编写，并在Windows环境下运行，其内部组件可以被分为以下三个层级：
\begin{enumerate}
	\item 设备的抽象层。分别用一个C++的抽象类代表\ref{sec:pmt_test:testbench_functions}节中介绍的四个功能模块，并将各种模块常用的操作抽象出来作为借口函数。任何一个新加入的设备都可以从这四个抽象类中继承出来，并对提供自己接口函数实现。软件框架里的其余部分可以通过这四个抽象类来完成自己的功能，并不涉及其具体实现，从而将底层硬件与顶层功能隔离开来。
	\item 测试算法与辅助功能库。这一层提供了一些基于上述的设备抽象层实现的一些较为通用的测试用例算法，以及一些管理类和辅助功能类。
	\item 用户交互层。这一层主要处理和用户的交互，其具体实现与上两层无关，可以基于命令行，也可以基于图形界面。
\end{enumerate}
测控软件框架的具体设计细节可以参看附录\ref{appendix:pmttest_software}，此处略去。
对于PSD的光电倍增管测试来说，我们基于NI-VISA\cite{ni_visa}函数库实现了对PSD地面检测获取系统的控制，以代替通用的CAMAC数据获取模块。
针对PSD的测试需求，实现了Dy8增益测试、Dy5和Dy8的相对增益测试以及光阴极扫描测试这三个测试算法。
最后，我们基于PDCurses\cite{pdcurses}开发了一个命令行交互的测控程序，集成了设备控制，状态监控以及日志记录等功能。

\section{R4443裸管的性能测试}
\label{sec:pmt_test:characterization}
我们使用PMT批量测试平台对
% 分压器
% 高压分组导致从570支 选194 最后用164
% 获取系统组成，数据分析，数据库存储
% 统计信息 20一个run 共28个run 一个月测试完成
% 测试流程： 预热

\subsection{PSD对光电倍增管的测试需求}
由于PSD没有参加DAMPE的触发系统，PSD不需要对粒子的入射时间进行测量。
因此，R4443的时间性能参数没有实际的参考价值，无需在实验室对其进行专门的测试。
另一方面，PSD通过测量沉积能量来实现其所有功能(见第\ref{sec:description:psd_principle}节)，而光电倍增管的增益是直接影响探测器能量响应的重要参数。
因此，我们的测试主要关注R4443与增益相关的性能参数，这包括Dy8的增益以及Dy5和Dy8间的相对增益（简称Dy58比值）这两个方面。
% 能量响应均匀性的要求
PSD要求各探测单元模块的能量响应均匀性好于\SI{25}{\percent}。这意味着，需要

% 高压分组使得需要对大量管子进行测试
高压分组的限制

\subsection{相对增益的测量}
% 测试方法的介绍：
Dy8增益小
单光电子峰为电子倍增器的增益，没有包含光阴极的影响。
% 流程、配置介绍

% 结果介绍

\subsection{Dy8和Dy5之间相对增益的测量}
\subsection{光阴极均匀性的测量}

\subsection{PMT批量测试平台的长期稳定性}

\section{PMT的筛选}

\subsection{筛选方案}
工厂参数。
% 暗电流
PMT的暗电流是指在完全黑暗且没有入射光的条件下，在光电倍增管内部流动的微小电流。
由于暗电流会使得探测器的基线展宽、噪声变大，严重的情况下甚至降低探测器的能量分辨率，因此暗电流越小越好。
光电倍增管的光阴极材料是引起暗电流的主要因素。
PSD采用的R4443型号（即MOD2）使用低噪声的碱金属材料作为光阴极，从而极大地抑制了暗电流的大小。
根据Hamamatsu提供的出厂测试信息，我们发现所有管子的暗电流都小于PSD的要求。
% 增益
R4443的Dy8通道用于覆盖PSD动态范围的低端部分，主要用于$e/\gamma$；R4443的Dy5通道用于覆盖PSD动态范围的高端部分，主要用于相对论重离子的电荷测量。
我们希望Dy8的增益尽量高，使其测得的MIP信号尽量与基线噪声相分离，从而降低$e/\gamma$误判率。
另一方面，PSD对整体的动态范围有严格的区间要求($\SI{0.1}{MIPs}\sim\SI{1400}{MIPs}$)，过高的Dy8增益会压低Dy5的增益（即提高了Dy58比值），从而降低Dy5对重离子电荷的分辨能力。
因此
\subsection{参考单元模块的MIPs响应}
\subsection{与塑闪单元条的匹配}